# 购物系统

## 项目简介

这是一个基于C++开发的功能完整的购物系统，提供了用户管理、登录认证、商品管理和智能搜索等功能。系统支持管理员和顾客两种角色，管理员可以管理商品和用户信息，顾客可以注册、登录、搜索和浏览商品。

## 功能特性

### 1. 登录功能
- **管理员登录**：通过配置文件预设的账号密码登录
- **顾客登录**：使用注册的账号密码登录
- **顾客注册**：首次使用需要注册，设置用户名、密码和手机号

### 2. 用户管理
- **保存顾客信息**：将注册信息保存到CSV文件
- **修改密码**：顾客可以修改自己的密码
- **查看用户**：管理员可以查看所有顾客信息

### 3. 商品管理（管理员功能）⭐新增
- **查看商品**：表格化显示所有商品信息
- **添加商品**：添加新商品，支持自动生成ID
- **修改商品**：逐字段修改商品信息，实时显示更新
- **删除商品**：删除指定商品，带确认提示
- **双重索引**：使用vector和map<类别>维护商品数据
- **动态表头**：支持自定义CSV表头字段

### 4. 商品搜索（顾客功能）⭐新增
- **精确搜索**：按商品名称、类别精确匹配
- **模糊搜索**：使用Levenshtein编辑距离算法
  - 计算字符串相似度
  - 支持关键字部分匹配
  - 搜索商品名称和描述
  - 结果按相似度排序
- **智能策略**：先精确搜索，无结果自动切换模糊搜索
- **结果展示**：表格化显示，支持相似度百分比

## 技术架构

### 设计原则
- **面向对象设计**：采用OOP思想，实现高内聚、低耦合
- **模块化架构**：分为配置管理、用户管理、登录系统等独立模块
- **单例模式**：配置管理器采用单例模式
- **智能指针**：使用`std::shared_ptr`管理对象生命周期

### 项目结构
```
shopping/
├── CMakeLists.txt          # CMake构建配置
├── config.yaml             # 系统配置文件
├── DevDoc/                 # 开发文档目录
│   ├── dev.md              # 第一期需求文档
│   └── dev_2.md            # 第二期需求文档
├── README.md               # 项目说明文档
├── ChangeLog.md            # 变更日志
├── Include/                # 头文件目录
│   ├── Config.h            # 配置管理类
│   ├── Login/
│   │   └── LoginSystem.h   # 登录系统类
│   ├── UserManage/
│   │   ├── User.h          # 用户基类和子类
│   │   └── UserManager.h   # 用户管理器
│   └── ItemManage/         # ⭐新增商品管理模块
│       ├── Item.h          # 商品类
│       ├── ItemManager.h   # 商品管理器
│       └── ItemSearcher.h  # 商品搜索器
├── Src/                    # 源文件目录
│   ├── Config.cpp
│   ├── Login/
│   │   └── LoginSystem.cpp
│   ├── Main/
│   │   └── main.cpp        # 主程序入口
│   ├── UserManage/
│   │   ├── User.cpp
│   │   └── UserManager.cpp
│   └── ItemManage/         # ⭐新增商品管理实现
│       ├── Item.cpp
│       ├── ItemManager.cpp
│       └── ItemSearcher.cpp
├── data/                   # 数据文件目录
│   ├── users.csv           # 用户数据文件
│   └── items.csv           # 商品数据文件（含类别和描述）
└── bin/                    # 编译输出目录
```
│   │   └── main.cpp        # 主程序入口
│   └── UserManage/
│       ├── User.cpp
│       └── UserManager.cpp
├── data/                   # 数据文件目录
│   ├── users.csv           # 用户数据文件
│   └── items.csv           # 商品数据文件
└── bin/                    # 编译输出目录
```

### 核心模块

#### 1. Config（配置管理）
- 负责读取和解析`config.yaml`配置文件
- 提供管理员账号密码
- 提供数据文件路径
- 采用单例模式确保全局唯一配置

#### 2. UserManage（用户管理）
- **User**：用户基类，定义通用属性和方法
- **Customer**：顾客类，继承自User
- **Admin**：管理员类，继承自User
- **UserManager**：用户管理器，负责CSV文件读写和用户增删改查

#### 3. Login（登录系统）
- **LoginSystem**：登录系统类
  - 处理管理员和顾客的登录验证
  - 顾客注册功能
  - 密码修改功能
  - 会话管理

#### 4. Main（主程序）
- 提供控制台交互界面
- 整合各模块功能
- 根据用户角色显示不同菜单
- 支持商品管理和搜索操作

### 核心算法

#### Levenshtein编辑距离算法
用于模糊搜索的核心算法，计算两个字符串之间的相似度。

**算法原理**：
- 使用动态规划计算最小编辑次数
- 编辑操作包括：插入、删除、替换字符
- 时间复杂度：O(m×n)，空间复杂度：O(m×n)

**相似度计算**：
```
相似度 = 1 - (编辑距离 / max(字符串1长度, 字符串2长度))
```

**增强匹配**：
- 编辑距离相似度
- 子串包含检测（提升至0.7分）
- 描述内容匹配（提升至0.6分）
- 综合评分取最高值

## 编译和运行

### 环境要求
- **操作系统**：Windows
- **编译器**：MinGW（支持C++17）
- **构建工具**：CMake 3.15+

### 编译步骤

1. 创建构建目录：
```powershell
mkdir build
cd build
```

2. 生成构建文件：
```powershell
cmake -G "MinGW Makefiles" ..
```

3. 编译项目：
```powershell
mingw32-make
```

4. 运行程序：
```powershell
cd ..\bin
.\ShoppingSystem.exe
```

### 快速编译脚本
也可以使用以下命令一键编译：
```powershell
# 清理旧的构建文件
if (Test-Path build) { Remove-Item -Recurse -Force build }
mkdir build
cd build
cmake -G "MinGW Makefiles" ..
mingw32-make
cd ..
```

## 配置说明

### config.yaml
```yaml
# 管理员账户信息
admin:
  username: admin
  password: admin123

# 数据文件路径
data_files:
  users: data/users.csv
  items: data/items.csv
```

### users.csv
```csv
username,password,phone
```

### items.csv（⭐已更新格式）
```csv
item_id,item_name,category,price,description,stock
1,Apple iPhone 15,手机,5999.00,最新款苹果旗舰手机,50
2,Samsung Galaxy S24,手机,4999.00,三星高端智能手机,30
```

**字段说明**：
- `item_id`：商品唯一标识
- `item_name`：商品名称
- `category`：商品类别（新增）
- `price`：商品价格
- `description`：商品描述（新增）
- `stock`：库存数量

## 使用说明

### 1. 启动程序
运行`ShoppingSystem.exe`后，会显示主菜单：

```
========== 购物系统 ==========
1. 顾客注册
2. 顾客登录
3. 管理员登录
4. 查看商品信息（无需登录）
0. 退出系统
=============================
```

### 2. 顾客注册
选择选项1，输入用户名、密码和手机号即可注册。

### 3. 顾客登录
选择选项2，使用注册的账号密码登录后，可以：
- 查看商品信息
- 修改密码
- 登出

### 4. 管理员登录
选择选项3，使用配置文件中的管理员账号登录后，可以：
- 查看所有顾客信息
- 查看所有商品信息
- 添加商品⭐
- 修改商品⭐
- 删除商品⭐
- 登出

默认管理员账号：
- 用户名：`admin`
- 密码：`admin123`

### 5. 商品搜索⭐新增
顾客登录后，选择"搜索商品"：
1. 输入搜索关键字（如"手机"、"iPhone"、"苹果"）
2. 系统先进行精确搜索
3. 无结果时自动切换模糊搜索
4. 显示搜索结果，包含相似度百分比
5. 结果按相似度降序排列

**搜索示例**：
- 输入"iPhone" → 精确匹配"Apple iPhone 15"
- 输入"手机" → 匹配所有手机类商品
- 输入"苹果" → 模糊匹配相关商品
- 输入"iPhon"（拼写错误）→ 模糊匹配"iPhone"

## 代码规范

### 注释规范
- 所有类和函数都有完整的Doxygen风格注释
- 注释量约占代码量的1/3
- 注释包含功能描述、参数说明、返回值说明等

### 命名规范
- **类名**：大驼峰命名法（如`LoginSystem`）
- **函数名**：小驼峰命名法（如`loadConfig`）
- **变量名**：小驼峰命名法（如`currentUser`）
- **常量名**：大写字母+下划线（如需要）

### 文件组织
- 头文件使用`.h`扩展名
- 源文件使用`.cpp`扩展名
- 头文件包含类声明和接口
- 源文件包含具体实现

## 扩展建议

### 已实现的扩展功能（v2.0）⭐
1. ✅ **商品管理系统**：完整的增删改查
2. ✅ **智能搜索**：精确+模糊搜索
3. ✅ **双重索引**：vector + map类别索引
4. ✅ **动态表头**：可扩展CSV字段

### 未来可添加的功能（v3.0+）
1. **购物车功能**：顾客可以将商品加入购物车
2. **订单管理**：记录购买历史和订单信息
3. **数据加密**：对密码进行加密存储
4. **日志系统**：记录系统操作日志
5. **权限细化**：更详细的权限管理
6. **图形界面**：使用Qt或其他GUI框架

## 常见问题

### Q: 编译时找不到头文件？
A: 确保CMakeLists.txt中的`include_directories`设置正确。

### Q: 运行时找不到配置文件？
A: 确保在bin目录下运行程序，且config.yaml文件已复制到该目录。

### Q: 无法保存用户数据？
A: 检查data目录是否存在，以及程序是否有写入权限。

## 许可证

本项目仅供学习和研究使用。

## 作者

Shopping System Development Team

## 更新日志

详见 [ChangeLog.md](ChangeLog.md)
